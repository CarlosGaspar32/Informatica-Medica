#include <Arduino.h>
#include "Antirrebotes.h"

#define senTemp A0
//ECG 1000 datos, fs = 100Hz, t = 10s
const uint8_t ECG[] PROGMEM = {77,	76,	77,	75,	76,	76,	76,	74,	75,	73,	75,	73,	75,	73,	74,	74,	74,	73,	74,	72,	74,	78,	83,	84,	87,	98,	97,	87,	83,	79,	74,	63,	63,	63,	63,	59,	70,	117,	198,	230,	67,	0,	24,	48,	67,	66,	69,	67,	71,	70,	74,	73,	76,	77,	81,	82,	86,	87,	92,	94,	98,	101,	103,	105,	106,	105,	106,	106,	103,	100,	95,	90,	87,	85,	83,	82,	82,	82,	81,	82,	83,	82,	81,	81,	81,	80,	79,	78,	78,	77,	76,	76,	77,	77,	75,	75,	74,	76,	75,	75,	75,	74,	74,	75,	74,	73,	72,	74,	73,	76,	78,	83,	86,	90,	102,	97,	88,	81,	80,	71,	65,	64,	64,	64,	61,	84,	140,	201,	179,	67,	9,	19,	48,	65,	68,	68,	68,	72,	71,	74,	74,	76,	79,	81,	83,	85,	87,	91,	94,	97,	99,	104,	102,	105,	104,	104,	104,	99,	96,	93,	88,	86,	82,	83,	82,	81,	81,	82,	83,	81,	82,	79,	79,	78,	79,	77,	75,	78,	75,	74,	75,	74,	75,	75,	74,	74,	73,	73,	72,	75,	71,	73,	73,	73,	75,	82,	84,	88,	101,	97,	90,	82,	80,	72,	65,	65,	61,	65,	59,	80,	136,	204,	205,	72,	3,	14,	45,	66,	67,	69,	68,	71,	71,	74,	73,	78,	78,	82,	82,	86,	91,	90,	97,	98,	103,	103,	107,	106,	107,	107,	104,	101,	98,	92,	86,	85,	83,	81,	80,	83,	81,	82,	80,	80,	81,	82,	79,	79,	78,	78,	79,	75,	76,	73,	74,	74,	74,	73,	73,	75,	72,	72,	73,	72,	73,	73,	74,	79,	84,	86,	90,	102,	95,	87,	79,	77,	67,	62,	60,	63,	61,	56,	90,	169,	232,	145,	39,	1,	23,	52,	65,	65,	66,	69,	69,	71,	72,	74,	77,	80,	81,	84,	88,	90,	93,	99,	103,	103,	106,	106,	109,	109,	106,	104,	100,	95,	92,	85,	81,	80,	79,	79,	79,	79,	79,	81,	79,	79,	80,	78,	76,	77,	77,	74,	75,	73,	74,	72,	74,	73,	72,	71,	73,	71,	72,	69,	73,	70,	72,	74,	81,	85,	86,	96,	99,	93,	86,	78,	78,	66,	62,	61,	65,	62,	61,	100,	192,	253,	116,	21,	12,	37,	65,	66,	68,	67,	71,	71,	72,	72,	74,	77,	81,	82,	85,	88,	91,	93,	101,	103,	107,	106,	110,	110,	111,	109,	106,	100,	96,	92,	87,	83,	82,	80,	80,	80,	81,	83,	82,	82,	82,	82,	82,	80,	81,	79,	79,	79,	78,	77,	78,	76,	77,	76,	77,	74,	75,	73,	74,	73,	74,	73,	74,	73,	75,	73,	75,	75,	83,	86,	86,	96,	97,	90,	84,	78,	77,	64,	64,	61,	65,	62,	64,	105,	198,	255,	98,	13,	17,	42,	68,	67,	69,	68,	71,	70,	74,	74,	77,	79,	81,	83,	86,	88,	92,	94,	99,	102,	106,	107,	108,	108,	109,	108,	106,	101,	97,	93,	89,	85,	85,	84,	84,	84,	84,	84,	85,	85,	85,	85,	84,	83,	83,	82,	81,	81,	80,	79,	79,	78,	79,	78,	78,	77,	78,	77,	78,	77,	78,	77,	77,	75,	76,	74,	75,	74,	76,	75,	76,	75,	76,	80,	85,	87,	89,	101,	97,	88,	84,	79,	77,	65,	66,	63,	65,	61,	71,	118,	207,	242,	71,	1,	26,	53,	70,	67,	70,	69,	72,	71,	74,	74,	77,	79,	82,	83,	87,	88,	92,	95,	100,	102,	105,	106,	107,	108,	109,	107,	105,	100,	96,	91,	88,	85,	84,	84,	84,	83,	83,	83,	84,	83,	85,	84,	83,	82,	81,	81,	81,	80,	79,	80,	78,	78,	78,	77,	76,	76,	77,	76,	76,	77,	77,	77,	77,	76,	75,	76,	75,	76,	75,	76,	74,	76,	74,	75,	74,	77,	78,	85,	87,	88,	101,	98,	89,	85,	80,	77,	65,	67,	66,	66,	63,	73,	118,	194,	232,	79,	10,	21,	46,	70,	68,	69,	68,	71,	70,	72,	74,	77,	77,	79,	81,	85,	87,	89,	92,	97,	101,	104,	103,	105,	106,	107,	106,	105,	100,	96,	92,	88,	86,	84,	83,	83,	82,	83,	83,	83,	83,	82,	82,	81,	81,	79,	78,	77,	77,	77,	76,	76,	75,	76,	76,	75,	75,	75,	74,	75,	74,	75,	74,	75,	74,	75,	74,	75,	73,	74,	73,	75,	74,	74,	75,	81,	85,	88,	98,	99,	92,	84,	79,	78,	65,	66,	64,	65,	63,	72,	116,	192,	230,	89,	17,	14,	39,	64,	67,	69,	69,	71,	71,	72,	73,	77,	78,	81,	82,	87,	88,	92,	95,	99,	101,	104,	105,	107,	107,	107,	106,	104,	99,	95,	90,	87,	84,	85,	83,	83,	83,	83,	83,	83,	82,	82,	82,	80,	82,	79,	79,	78,	78,	79,	77,	76,	78,	76,	76,	76,	76,	76,	76,	76,	76,	76,	76,	74,	77,	74,	76,	74,	75,	74,	78,	74,	75,	77,	83,	88,	89,	99,	98,	91,	84,	81,	78,	66,	66,	65,	67,	63,	72,	119,	199,	238,	90,	14,	17,	42,	67,	67,	69,	69,	72,	72,	74,	74,	76,	78,	82,	83,	87,	89,	93,	95,	100,	102,	106,	108,	110,	109,	110,	107,	104,	100,	97,	92,	87,	85,	84,	83,	83,	83,	83,	83,	83,	83,	83,	82,	82,	82,	81,	80,	79,	78,	78,	78,	78,	76,	76,	75,	76,	74,	74,	74,	76,	74,	74,	73,	74,	74,	74,	74,	74,	73,	74,	72,	74,	73,	74,	77,	83,	86,	88,	100,	96,	89,	84,	79,	75,	64,	64,	62,	65,	60,	72,	121,	204,	237,	80,	6,	21,	46,	67,	66,	68,	67,	70,	68,	70,	71,	75,	76,	79,	81,	84,	86,	91,	93,	98,	101,	105,	105,	107,	106,	107,	105,	103,	98,	94,	90,	88,	85,	83,	82,	81,	82,	82,	82,	83,	83,	83,	83,	83,	82,	82,	81,	80,	79,	78,	77,	77,	77,	77,	77,	77,	77,	77,	76,	77,	77
};
float Temp = 0.0;
uint8_t pulso = 0;

//Antirrebotes botonAntirrebotespin3(3); // Crea una instancia de la clase Antirrebotes para el pin 2
//Antirrebotes botonAntirrebotespin4(4);

void setup() {
  Serial.begin(9600);
  pinMode(5, INPUT_PULLUP); //Interrupcion
}

void loop() {
  for(uint16_t i=0;i<1000;i=i+2){
    //float currenttime = micros();
    uint8_t dato = digitalRead(5);
    if (dato == 0) {
      Serial.println(2000);
    }
    // Temperatura
    Temp = analogRead(senTemp) * (5.0 / 1023.0);
    Temp = Temp / 0.01;
    // Pulso
    if (digitalRead(3) == 0){
      pulso = pulso + 1;
    }
    if (digitalRead(4) == 0){
      pulso = pulso - 1;
    }
    /*
    if (botonAntirrebotespin3.estadoBoton()) {
      pulso = pulso + 1;
    }
    if (botonAntirrebotespin4.estadoBoton()) {
      pulso = pulso - 1;
    }
    */
    Serial.println("HA" + String(pgm_read_byte(&(ECG[i]))) + 'T' + String(Temp) + 'P' + pulso + 'C');
    delay(49);
    //float time = micros() - currenttime;
    //Serial.println(time);
  }
}


